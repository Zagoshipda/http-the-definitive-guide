# Answers

## Q. 프락시가 다음 부모들의 부하 수준을 어떻게 알까?
> https://jins-dev.tistory.com/entry/L4-L7-로드밸런싱Load-Balancing-에-대하여
> https://tomining.tistory.com/117
- L2, L3, L4, L7은 OSI 7계층 중 스위칭이 일어나고 있는 계층에 따라 결정된다.
- L3 이하의 스위치에서는 Mac 주소(L2), IP 주소(L3) 계층에서 동작하기 때문에, 실질적으로는 로드 밸런싱을 하기 어렵다.
- L4에서는 TCP/IP 프로토콜을 기반으로, IP 주소 + 포트 번호 기반 스위칭을 지원한다.
  - 라운드 로빈 방식: 오는 대로 순차적으로 세션을 맺어준다.
  - 최소 커넥션: 가장 적은 오픈 세션을 가진 서버로 맺어준다.
  - 응답 시간: 서버와 직접 통신해보면서 응답 시간이 빠른 쪽으로 많은 세션을 할당해준다.
  - 해시: 특정 클라이언트는 특정 서버로만 할당시킨다. (cf. minimum missis: 서버 다운시 해시 재할당이 이루어진다.)
  - 대역폭: 서버들과의 대역폭을 고려해서 분산한다.
- L7 HTTP 애플리케이션 계층에서 동작하므로 애플리케이션 수준에서 IP 주소 + 포트 번호 + 패킷 내용 기반 스위칭이 가능하다.
  - 쿠키: 쿠키 정보를 분석하여 지속 커넥션을 유지한다.
  - 컨텍스트 스위칭: 클라이언트가 요청한 리소스에 대해 컨텍스트를 전환할 수 있다. (예: 이미지 리소스 요청에 대해 이미지 서버로 옮겨준다.)
  - 콘텐츠 재작성: 전달받은 요청을 변환해서 재전송한다.

## Q. DHCP, SLP, DNS SRC 레코드, DNS TXT 레코드 안의 서비스 URI에 대해
현재의 WPAD 명세는 다음과 같은 기법을 순서대로 정의한다.
1) 동적 호스트 발견 규약 (DHCP)
2) 서비스 위치 규약 (SLP)
3) DNS 잘 알려진 호스트 명
4) DNS SRV 레코드
5) DNS TXT 레코드 안의 서비스 URI

> 20.5.3장에 WPAD 프로토콜에 대한 자세한 설명이 들어 있다.

### 웹 프락시 자동발견 프로토콜(WPAD)
- 웹브라우저가 근처의 프락시를 찾아내어 사용할 수 있게 해주는 방법
- HTTP 클라이언트가 PAC 파일의 위치를 알아내고 그 파일을 이용해서 적절한 프락시 서버의 이름을 알아낼 수 있게 해줌
- 최종 사용자가 수동으로 프락시 설정을 할 필요 없음
- 투명한 트래픽 인터셉트에 의존할 필요도 없음 (?)

#### WPAD 클라이언트
1) DHCP를 먼저 시도한다.
DHCP 서버가 PAC 파일이 있는 CURL(설정 URL)을 가지고 있어야 한다.
2) 실패하면 SLP(서비스 위치 프로토콜)를 시도한다.
3) 실패하면 DNS 기반 매커니즘으로 옮겨간다. 잘 알려진 호스트 명부터 SRV 레코드, 서비스 URI까지 구체적인 정보부터 알아내려고 시도하다가 실패하면 덜 구체적인 정보라도 취하려고 한다.

> 나머지 구체적인 내용은 명세를 참고하라고 하지만 이것까지 알아야 할 필요는 없을 것 같다.

## Q. 현대 브라우저 환경에서 via 헤더를 사용해 어떤 일들을 할까?
ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Via
1) 일반적으로 메시지가 어떤 중개자를 거쳐왔는지를 표시함
2) 요청 루프에 빠지는 것을 방지함
3) 요청/응답 체인을 통해 사용할 수 있는 프로토콜을 확인함
ex. 특정 프록시를 거쳐 갔을 때 프로토콜 버전이 다운그레이드 된 것을 확인함
