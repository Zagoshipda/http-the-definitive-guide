# Answers

# pseudocoder kim

### Q. 프락시는 다음 부모 프락시들의 부하 수준을 어떻게 알 수 있나

- 자식 프락시는 부하를 분산하기 위해 현재 부모들의 작업량 수준에 근거하여 부모 프락시를 고른다.
- 작업량 수준은 여러가지가 있다
    - transaction이 fail한 횟수를 카운트, 그 횟수가 많으면 해당 proxy를 특정 시간동안 unavailable로 두고 다른 proxy에 요청을 전달함.
    - 특정 시간마다(5초) ping을 보내, communication error, timeout을 체크.
- recover된 서버에게는 slow start를 적용.

## ref

- [https://tech.cloud.nongshim.co.kr/2018/10/16/초보자를-위한-aws-웹구축-7-elb-생성하기-작성중/](https://tech.cloud.nongshim.co.kr/2018/10/16/%EC%B4%88%EB%B3%B4%EC%9E%90%EB%A5%BC-%EC%9C%84%ED%95%9C-aws-%EC%9B%B9%EA%B5%AC%EC%B6%95-7-elb-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0-%EC%9E%91%EC%84%B1%EC%A4%91/)
- [https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/)
- [https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-health-check/](https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-health-check/)

### Q. 현대 브라우저 환경에서 via 헤더를 사용해 어떤 일들을 할까

- via는 메시지가 지나는 각 중간 노드의 정보를 나열.
- 중간 노드를 지날 때 마다, via 목록의 끝에 추가됨.
- Q - via가 있다는 걸 어떻게 알아서 추가할까?

---

- via header는 request, response에 모두 추가됨.
    - forward, reverse proxy들에 의해 추가.
- 메시지 포워딩 추적, request loop 막기, sender의 protocol capability를 알기 위해 사용됨.

---

- via 헤더가 없으면, proxy에게 origin server가 gzip compressed 된 데이터를 넘기지 않을 수 있음.
- proxy가 처리를 못할 거라고 생각하기 때문.
- via 헤더에 identify를 해주어야.

## ref

- [https://stackoverflow.com/questions/15248785/the-difference-between-the-x-forwarded-for-header-and-the-via-header](https://stackoverflow.com/questions/15248785/the-difference-between-the-x-forwarded-for-header-and-the-via-header)
- [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Via](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Via)
- [https://community.akamai.com/customers/s/article/Beware-the-Via-header-and-its-bandwidth-impact-on-your-origin?language=en_US](https://community.akamai.com/customers/s/article/Beware-the-Via-header-and-its-bandwidth-impact-on-your-origin?language=en_US)

### Q. DHCP, SLP, DNS SRC 레코드, DNS TXT 레코드 안의 서비스 URI 에 대해

- WPAD(Web Proxy Autodiscovery Protocol) 명세가 정의하는 것들.
- WPAD?
    - DHCP 혹은 DNS discovery를 이용, 사용자가 설정 파일의 URL 위치를 알 수 있도록 하는 방법 중 하나.
    - client가 자동으로 캐시 서비스를 설정해, 더 빠르게 컨텐츠를 전달받을 수 있게 함.
    - 브라우저는 자동으로 설정파일을 다운로드 받아, 특정 URL 혹은 호스트에 대한 proxy 설정을 하게 됨.
    - 실제 설정 파일 포멧은 PAC(Proxy Auto config format)이 사용됨. - [https://mudfish.net/docs/ko/vpn/features/wpad/pac.html](https://mudfish.net/docs/ko/vpn/features/wpad/pac.html)
- `findProxyForURL`을 이용, 어떤 proxy를 설정할 것인지를 정할 수 있다.(이건 수동설정인가?..)

**DHCP(Dynamic Host Configuration Protocol)**

- dhcp server가 각 디바이스에 동적으로 ip 주소를 할당, 해당 ip 주소로 다른 네트워크와 통신할 수 있게 하는 네트워크 관리 프로토콜.
- 각 컴퓨터에 대해 자동으로 ISP를 통해 ip를 할당하게 함.
- client는 `DHCPINFORM` query를 날리고, DHCP 서버는 PAC 파일의 정보가 담긴 세팅을 리턴. client는 PAC파일을 다운로드.

**SLP(service location procol)**

- DHCP가 실패하면 SLP를 사용.
- LAN에서 서비스를 찾을 수 있게 하는 프로토콜.
- 각 서비스는 URL이 있음.
    - 서비스 중, Directory Agent(DA)가 서비스 정보를 캐싱하는 데 사용됨.

**DNS records**

- 위 두가지가 실패하면 여기로 넘어옴.
- DNS SRV record(DNS service record) - DNS에서 위치를 정의하는 명세.
    - `_service._proto.name. TTL class SRV priority weight port target.`
- `wpad.dat` 이란 파일 이름으로 있어야 함. - `[wpad.blabla.com/wpad.dat](http://wpad.blabla.com/wpad.dat)` 으로 요청할 것.

## ref

- [https://www.cisco.com/c/en/us/td/docs/security/web_security/connector/connector3000/WPADAP.html](https://www.cisco.com/c/en/us/td/docs/security/web_security/connector/connector3000/WPADAP.html)
- [https://mudfish.net/docs/ko/vpn/features/wpad.html](https://mudfish.net/docs/ko/vpn/features/wpad.html)
- [https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol](https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol)
- [https://en.wikipedia.org/wiki/Service_Location_Protocol](https://en.wikipedia.org/wiki/Service_Location_Protocol)
- [https://www.netmanias.com/ko/post/blog/5348/dhcp-ip-allocation-network-protocol/understanding-the-basic-operations-of-dhcp](https://www.netmanias.com/ko/post/blog/5348/dhcp-ip-allocation-network-protocol/understanding-the-basic-operations-of-dhcp)
- [https://namu.wiki/w/DHCP](https://namu.wiki/w/DHCP)
- [https://whatis.techtarget.com/definition/Web-Proxy-Autodiscovery-WPAD](https://whatis.techtarget.com/definition/Web-Proxy-Autodiscovery-WPAD)
- [https://en.wikipedia.org/wiki/WS-Discovery](https://en.wikipedia.org/wiki/WS-Discovery)
- [https://en.wikipedia.org/wiki/SRV_record](https://en.wikipedia.org/wiki/SRV_record)

