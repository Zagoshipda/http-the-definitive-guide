# 03. HTTP 메시지

## 3.1 메시지의 흐름

**HTTP 메시지**

* 정의: HTTP 애플리케이션 사이에서 주고받은 데이터 블록들
* 구성: 1\) 텍스트 메타 정보 + 2\) 데이터\(optional\)
  * 텍스트 메타 정보: 메시지의 내용과 의미를 설명함
* 방향: 인바운드, 아웃바운드, 업스트림, 다운스트림

### 3.1.1 인바운드: 서버 방향 송신

* 인바운드: 사용자 에이전트 → 서버
* 아웃바운드: 서버 → 사용자 에이전트

### 3.1.2 다운스트림: 메시지의 방향

* 모든 메시지는 다운스트림으로 흐른다
* 요청/응답 메시지 모두 다운스트림으로 흐른다
* \(업스트림\) 발송자 → \(다운스트림\) 수신자

## 3.2 메시지의 각 부분

* 시작줄 + 헤더 + 본문
* 시작줄과 헤더는 CRLF로 구분되나, 그 자리에 개행 문자가 오기도 하고, 아무 것도 안 오기도 한다. 견고한 애플리케이션이라면 이런 모든 상황을 대처할 수 있어야 한다.

### 3.2.1 메시지 문법

* 요청 메시지: 서버에 동작 요구
* 응답 메시지: 요청의 결과를 클라이언트에게 돌려줌

  ```text
  # 요청 메시지
  GET /specials/saw-blade.gif HTTP/1.0
  Host: www.joes-hardware.com
  ​
  <메서드> <요청 URL> <버전>
  <헤더>
  ​
  <엔티티 본문>
  ​
  # 응답 메시지
  HTTP/1.0 200 OK
  Content-Type: image/gif
  Content-length: 8572
  ​
  <버전> <상태 코드> <사유 구절>
  <헤더>
  ​
  <엔티티 본문>
  ```

**요청 URL**

* 요청 대상 리소스의 완전한 URL 또는 URL의 경로 구성 요소
* 불완전한 URL이더라도 서버는 생략된 호스트/포트가 자신을 가리키는 것으로 간주함

**사유 구절**

* 상태 코드의 사람이 이해할 수 있는 버전
* 특별한 규칙 없음
* `HTTP/1.0 200 NOT OK` 와 `HTTP/1.0 200 OK`는 동등하게 성공을 의미하는 것으로 처리

**엔티티 본문**

* 임의의 데이터 블록
* 엔티티 블록을 포함하지 않는 메시지들은 그냥 CRLF로 끝남

### 3.2.2 시작줄

**메서드**

> [3.3 메서드](./#3-3)

**상태 코드**

| 전체 범위 | 정의된 범위 | 분류 |
| :--- | :--- | :--- |
| 100-199 | 100-101 | 정보 |
| 200-299 | 200-206 | 성공 |
| 300-399 | 300-305 | 리다이렉션 |
| 400-499 | 400-415 | 클라이언트 에러 |
| 500-599 | 500-505 | 서버 에러 |

* 인식할 수 없는 상태 코드를 받게 되면 그것이 포함되는 범위의 일부라고 가정해야 함
* ex. 515는 다른 5XX 메시지들과 마찬가지로 서버 에러를 의미할 것

**대표적인 상태 코드**

* 200 OK: 성공 요청한 모든 데이터가 응답 본문에 들어 있다.
* 401 Unauthorized: 사용자 이름과 비밀번호를 입력해야 한다.
* 404 Not Found: 서버가 요청 URL에 해당하는 리소스를 찾지 못했다.

**버전 번호**

* 요청, 응답 메시지에 모두 포함
* 응답을 보낸 애플리케이션이 이해하는 가장 높은 HTTP 버전을 가리킴
* HTTP 대화 상대의 능력과 메시지 형식에 대한 단서
* HTTP 버전을 소수라고 생각하면 안 됨 \(ex. HTTP/2.22는 HTTP/2.3보다 크다\)

### 3.2.3 헤더

**헤더 분류**

* 일반 헤더: 요청, 응답 양쪽에 모두 나타날 수 있음
* 요청 헤더: 요청에 대한 부가 정보 제공
* 응답 헤더: 응답에 대한 부가 정보 제공
* Entity 헤더: 본문 크기와 콘텐츠 혹은 리소스 그 자체를 서술
* 확장 헤더: 명세에 정의되지 않은 새로운 헤더

**헤더를 여러 줄로 나누기**

* 긴 헤더 줄을 여러 줄로 쪼개서 더 읽기 좋게 만들 수 있다.

  ```text
  # 두 헤더 줄은 같음
  Server: Test Server
      Version 1.0
  Server: Test Server Version 1.0
  ```

### 3.2.4 엔티티 본문

이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 신용카드 트랜잭션, 전자우편 등 여러 종류의 디지털 데이터

### 3.2.5 버전 0.9 메시지

* 요청: 메서드 + 요청 URL \(ex. `GET /specials/saw-blade.gif`\)
* 응답: 엔티티
* 버전 정보, 상태 코드, 사유 구절, 헤더 등이 없음

## 3.3 메서드

* 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작을 요청 메시지에 전달
* 한 단어로 되어 있음 \(ex. `GET`, `HEAD`, `POST`\)
* 확장 메서드: 특정 서버가 추가로 구현한 HTTP 메서드

  | 메서드 | 설명 | 본문 |
  | :--- | :--- | :--- |
  | GET | 서버에서 어떤 문서를 가져온다. | X |
  | HEAD | 서버에서 어떤 문서에 대해 헤더만 가져온다. | X |
  | POST | 서버가 처리해야 할 데이터를 보낸다. | O |
  | PUT | 서버에 요청 메시지의 본문을 저장한다. | O |
  | TRACE | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | X |
  | OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다. | X |
  | DELETE | 서버에서 문서를 제거한다. | X |

* 모든 서버가 모든 메서드를 구현하지는 않음
* 메서드는 대부분 제한적으로 사용됨 \(아무나 메서드를 사용할 수 없음\)

### 3.3.1 안전한 메서드

* HTTP 요청의 결과로 서버에 어떤 작용도 없는 것
* 안전한 메서드가 서버에 작용을 유발하지 않는다는 보장은 없음
* 안전한 메서드의 목적은 안전하지 않은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 것임

## 3.4 상태 코드

## 3.5 헤더

* &lt;이름&gt; &lt;콜론\(:\)&gt; \(&lt;공백&gt;\) &lt;값&gt; &lt;CRLF&gt;가 순서대로 나타나는 0개 이상의 헤더들
* HTTP/1.1과 같은 몇몇 버전의 HTTP는 요청이나 응답에 특정 헤더가 포함되어야만 유효한 것으로 간주

## 3.6 추가 정보

